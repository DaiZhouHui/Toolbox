name: Update Dashboard

on:
  schedule:
    # æ¯å¤©å›½é™…æ ‡å‡†æ—¶é—´0ç‚¹ï¼ˆåŒ—äº¬æ—¶é—´8ç‚¹ï¼‰è¿è¡Œ
    - cron: '0 0 * * *'
  workflow_dispatch: # å…è®¸æ‰‹åŠ¨è§¦å‘
  push:
    branches: [ main ]
    paths:
      - 'generate_auto_descriptions.py'
      - '.github/workflows/*'

jobs:
  update:
    runs-on: ubuntu-latest
    permissions:
      contents: write # å…è®¸å·¥ä½œæµå†™å…¥å†…å®¹ï¼ˆæäº¤ä»£ç ï¼‰
    
    steps:
      - name: ğŸ”„ æ£€å‡ºä»£ç 
        uses: actions/checkout@v4
        with:
          submodules: recursive
          token: ${{ secrets.GITHUB_TOKEN }}
          
      - name: ğŸ è®¾ç½®Python
        uses: actions/setup-python@v4
        with:
          python-version: '3.14'
          
      - name: ğŸ“¦ å®‰è£…ä¾èµ–
        run: pip install -r requirements.txt

        
      - name: ğŸ¤– è¿è¡Œè‡ªåŠ¨ç”Ÿæˆè„šæœ¬
        env:
          # å…³é”®æ­¥éª¤ï¼šå°†ä»“åº“Secretä¼ é€’ç»™è„šæœ¬ç¯å¢ƒå˜é‡
          GITHUB_TOKEN: ${{ secrets.GITHUB_TOKEN }}
          GITHUB_USERNAME: ${{ vars.USERNAME }}
        run: python generate_auto_descriptions.py
        
      - name: ğŸ’¾ æäº¤æ›´æ–°
        run: |
          git config --global user.name "GitHub Actions Bot"
          git config --global user.email "actions@github.com"
          git add README.md tools_index.json
          git diff --quiet && git diff --staged --quiet || (git commit -m "ğŸ¤– è‡ªåŠ¨æ›´æ–°é¡¹ç›®ä»ªè¡¨æ¿ [skip ci]" && git push)